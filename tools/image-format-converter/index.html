<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>이미지 형식 변환기</title>
    <link rel="stylesheet" href="../../assets/css/style.css">
    <style>
        .tool-card {
            background-color: var(--background-secondary-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 2rem;
            max-width: 800px;
            margin: 2rem auto;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        .converter-layout { display: flex; gap: 2rem; }
        .controls { flex: 1; }
        .preview-area { flex: 1; text-align: center; }
        #preview { max-width: 100%; max-height: 300px; margin-top: 1rem; display: block; border: 1px solid var(--border-color); border-radius: 8px; }
        #download-link { display: none; margin-top: 1rem; }
        .file-upload-label { display: inline-block; padding: 10px 15px; background-color: var(--primary-color); color: white; border-radius: 5px; cursor: pointer; text-align: center; }
        #image-input { display: none; }
        .notice { font-size: 0.8rem; color: var(--text-secondary-color); margin-top: 1rem;}
    </style>
</head>
<body>
    <header>
        <div class="logo">이미지 형식 변환기</div>
        <button id="theme-toggle">☀️</button>
    </header>

    <main>
        <section id="image-format-converter" class="page-section active">
            <div class="tool-card">
                <div class="converter-layout">
                    <div class="controls">
                        <h4>1. 이미지 선택</h4>
                        <label for="image-input" class="file-upload-label">파일 찾기</label>
                        <input type="file" id="image-input" accept="image/*">
                        <p id="file-name">선택된 파일 없음</p>
                        
                        <h4 style="margin-top: 2rem;">2. 변환할 형식 선택</h4>
                        <div class="input-group">
                            <select id="format-select" style="width: 100%;">
                                <option value="jpeg">JPG</option>
                                <option value="png">PNG</option>
                                <option value="webp">WebP</option>
                                <option value="bmp">BMP</option>
                                <option value="gif">GIF (첫 프레임만)</option>
                            </select>
                        </div>
                        <button id="convert-btn" style="margin-top: 2rem; width: 100%;">변환하기</button>
                    </div>
                    <div class="preview-area">
                        <h4>미리보기</h4>
                        <img id="preview" src="" alt="이미지 미리보기">
                        <a id="download-link" class="button">다운로드</a>
                    </div>
                </div>
                 <p class="notice">참고: GIF 형식은 애니메이션의 첫 번째 프레임만 변환됩니다. 브라우저에 따라 일부 형식(예: BMP) 지원이 다를 수 있습니다.</p>
            </div>
        </section>
    </main>

    <script type="module">
        import { initTheme } from '../../assets/js/modules/theme.js';
        initTheme();

        const imageInput = document.getElementById('image-input');
        const formatSelect = document.getElementById('format-select');
        const convertBtn = document.getElementById('convert-btn');
        const preview = document.getElementById('preview');
        const downloadLink = document.getElementById('download-link');
        const fileNameDisplay = document.getElementById('file-name');
        let originalFile = null;

        imageInput.addEventListener('change', (e) => {
            originalFile = e.target.files[0];
            if (originalFile) {
                fileNameDisplay.textContent = originalFile.name;
                const reader = new FileReader();
                reader.onload = (event) => {
                    preview.src = event.target.result;
                };
                reader.readAsDataURL(originalFile);
                downloadLink.style.display = 'none';
            }
        });

        convertBtn.addEventListener('click', () => {
            if (!originalFile) {
                alert('먼저 이미지 파일을 선택해주세요.');
                return;
            }

            const image = new Image();
            image.src = preview.src;
            image.onload = () => {
                const canvas = document.createElement('canvas');
                canvas.width = image.width;
                canvas.height = image.height;
                const ctx = canvas.getContext('2d');
                ctx.drawImage(image, 0, 0);

                const targetFormat = formatSelect.value;
                const dataUrl = canvas.toDataURL(`image/${targetFormat}`);
                
                const originalFileName = originalFile.name.substring(0, originalFile.name.lastIndexOf('.'));
                downloadLink.href = dataUrl;
                downloadLink.download = `${originalFileName}.${targetFormat}`;
                downloadLink.style.display = 'inline-block';
                downloadLink.textContent = `변환된 이미지 다운로드 (${targetFormat.toUpperCase()})`;
            };
        });
    </script>
</body>
</html>
